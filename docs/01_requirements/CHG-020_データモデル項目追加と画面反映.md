# CHG-020: データモデル最小項目追加と画面反映

作成日: 2026-02-19
---
## 1. 背景
- 現状のデータモデル（Product / Cart / CartItem / Order / OrderItem / User）は、Phase 1 の基本フロー（閲覧→カート→注文）を成立させる最小構成になっている。
- ただし、業務運用（問い合わせ対応、出荷・返品を見据えた追跡、表示整合、会員管理、管理画面での運用）に必要な「最低限の識別・状態・連絡先・金額内訳・履歴」の情報が不足しており、後工程での仕様追加が画面・API・データに波及しやすい。
- そのため、追加コストが小さい段階で「業務上最低限」必要な情報カテゴリを補強し、顧客画面／BO画面の双方に反映して一貫した運用可能性を担保する。

---
## 2. 要件
### 2.1 Product（商品）に追加する最低限項目
- 商品を業務で一意に識別し、問い合わせや運用上の参照ができること
- 公開状態とは別に、販売可否を業務判断で制御できること
- 表示上の優先度や掲載順序を管理できること
- 在庫に関する顧客向け表示方針を運用として制御できること

### 2.2 Cart（カート）に追加する最低限項目
- カートのライフサイクル上の状態を追跡できること
- カート内の集計情報（数量・金額）を一貫して表示できること

### 2.3 CartItem（カートアイテム）に追加する最低限項目
- カート投入時点の表示情報を保持し、商品情報変更時の表示揺れを抑制できること
- カート投入時点と注文時点の条件差分が説明可能であること

### 2.4 Order（注文）に追加する最低限項目
- 連絡・配送に必要な注文時点情報を、会員情報と独立して保持できること
- 金額構成の内訳が説明できること
- 支払い手段の区別と、業務フロー上の状態遷移が追えること
- 顧客向け共有情報と内部運用情報を区別して管理できること
- キャンセルや変更の経緯・理由を記録できること
- 状態変化を顧客通知・運用通知へ連携可能な情報を保持できること

### 2.5 OrderItem（注文アイテム）に追加する最低限項目
- 注文行単位で金額構成が説明できること
- 返品・欠品・キャンセルなど後続業務に必要な行単位の状態管理ができること

### 2.6 User（会員）に追加する最低限項目
- 会員としての連絡先と基本プロフィールを業務上管理できること
- 利用停止や無効化などの運用判断の理由を追跡できること
- 規約同意などの重要イベントの履歴を追えること
- 会員が自身の情報と利用状況を自己管理できること（確認・更新・履歴参照）

### 2.7 画面反映（フロント／BO共通）
- 追加項目は「顧客画面で表示・入力すべき情報」と「BOで運用管理に必要な情報」に分類し、両画面に反映されること
  - 顧客画面: 参照しやすい商品情報、カート/注文の理解しやすい表示、注文関連情報の確認、会員ページでの自己管理導線
  - BO画面: 商品運用、注文運用、会員運用を支える管理情報
- 顧客画面とBO画面で同一概念（識別情報、状態、内訳、履歴）が同じ意味で扱われること

---
## 3. 受け入れ条件
- Product
  - 商品を識別するための情報が保持され、顧客画面とBO画面の双方で一貫して参照できる
  - 販売可否の制御情報が保持され、顧客向け導線とBO運用の双方で整合して扱える
  - 表示優先度に基づく表示制御が意図どおり反映される
- Cart / CartItem
  - カート集計情報（数量・金額）が顧客画面で安定表示できる
  - カート投入時点の表示情報が保持され、商品情報変更時にもカート表示が破綻しない
- Order / OrderItem
  - 注文時点の連絡・配送情報が保持され、顧客画面の注文確認/履歴で確認できる
  - 注文全体および注文行単位の金額内訳が顧客画面・BO画面で確認できる
  - 支払いと注文処理の状態情報、および変更理由情報がBO画面で確認できる
  - 顧客向け共有情報と内部運用情報が区別され、想定どおり表示制御される
  - 注文行ごとの状態管理により、返品/キャンセル等の運用区別が可能である
  - 注文状態の変化に応じて、顧客通知および運用通知に必要な情報を参照できる
- User
  - 会員の連絡先・基本プロフィールがBOで閲覧・更新できる
  - 運用上の状態理由および同意履歴が保持され、BOで確認できる
  - 会員ページで会員関連情報の参照/更新ができ、更新内容がBO運用情報と整合する
- 共通
  - 追加項目が API 仕様（型）と整合し、顧客画面/BO画面の入出力として一貫している
  - 既存のビジネスルール（公開商品表示、売り切れ不可、数量制限等）と矛盾しない

---
## 4. 仕様への反映
- データモデル定義（data-model.md 相当）に、各エンティティの追加情報カテゴリと意味（業務用途）を追記する
- API仕様（ui/api-spec.md）に、追加情報カテゴリの入出力（顧客/BOそれぞれ）を反映する
- 顧客画面仕様（ui/customer-ui.md 等）に、商品表示・カート表示・注文確認/履歴・会員ページでの表示/入力カテゴリを反映する
- BO画面仕様に、商品管理・注文管理・会員管理での表示/編集カテゴリを反映する
- 業務要件（requirements.md）に、販売運用・内訳管理・状態管理・同意管理などの前提ルールを追記する

---
## 5. 関連資料
- 技術仕様: ./SPEC.md
- 業務要件: ./requirements.md
- API仕様: ./ui/api-spec.md
- 在庫管理仕様: ./specs/inventory.md
- データモデル: ./data-model.md
