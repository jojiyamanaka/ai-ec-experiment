# アーカイブ（完了済み変更案件）

このディレクトリには、実装が完了し主要ドキュメントに反映された変更案件（CHG-XXX）のドキュメントが保管されています。

## 目的

- **主要ドキュメントを Single Source of Truth として維持**: 仕様はSPEC.md、requirements.md、data-model.mdなどに集約
- **詳細な履歴・背景を保持**: CHG案件の詳細な要件定義、設計、実装タスクは参照可能
- **ドキュメントディレクトリの整理**: 現在進行中の案件と完了済み案件を分離

## ディレクトリ構成

```
archive/
├── 01_requirements/     # 要件定義ドキュメント
├── 02_designs/          # 技術設計ドキュメント
└── 03_tasks/            # 実装タスクドキュメント
```

## アーカイブ済み案件

### CHG-002: 非公開商品カート整合性
- **実装完了日**: 2026-02-11
- **内容**: 商品が非公開になった際にカートから自動除外する機能
- **主要ドキュメント反映先**:
  - data-model.md: CartItem に非公開商品除外ルール追加
  - requirements.md: カート機能のビジネスルール追加

### CHG-003: カート数量上限
- **実装完了日**: 2026-02-11
- **内容**: 1商品あたりの購入数量を1〜9個に制限
- **主要ドキュメント反映先**:
  - data-model.md: CartItem の数量制約更新
  - requirements.md: カート機能のビジネスルール追加
  - ui/customer-ui.md: カート画面の数量制限仕様更新

### CHG-004: エラーメッセージ改善
- **実装完了日**: 2026-02-11
- **内容**: ユーザーフレンドリーなエラーメッセージへの改善
- **主要ドキュメント反映先**: 実装のみの改善のためドキュメント影響なし

### CHG-005: エディトリアルデザイン
- **実装完了日**: 2026-02-12
- **内容**: UI全体をエディトリアルデザインに刷新（モノトーン、セリフ体、広い余白）
- **主要ドキュメント反映先**:
  - ui/customer-ui.md: デザインシステムセクション全面刷新
  - design-system.md: 新規作成（デザインシステム仕様書）

### CHG-006: 会員機能追加
- **実装完了日**: 2026-02-12
- **内容**: トークンベース認証、ロールベースアクセス制御（RBAC）、操作履歴
- **主要ドキュメント反映先**:
  - data-model.md: User、AuthToken、OperationHistory エンティティ追加
  - api-spec.md: 認証API（5エンドポイント）追加
  - requirements.md: セッション管理を認証セクションに拡張
  - SPEC.md: 認証・認可セクション追加、Phase制約更新
  - specs/authentication.md: 新規作成（認証詳細仕様書）
  - specs/order.md: 会員/ゲスト区別、注文履歴取得追加
  - ui/admin-ui.md: 認証・認可セクション追加

### CHG-007: 管理画面拡張（注文・在庫・会員）
- **実装完了日**: 2026-02-13
- **内容**: 管理画面に注文管理、在庫管理、会員管理の3機能を追加
- **主要ドキュメント反映先**:
  - ui/admin-ui.md: 注文管理、在庫管理、会員管理の画面仕様追加
  - api-spec.md: 管理API（注文、在庫、会員）追加

### CHG-008: ドメイン分離とBoUser管理
- **実装完了日**: 2026-02-13
- **内容**: 顧客（Customer）と管理者（BoUser）のドメイン完全分離、BoUser専用認証基盤の構築
- **主要ドキュメント反映先**:
  - SPEC.md: ドメイン分離、BoUser認証、権限レベル、セキュリティ強化を追加
  - data-model.md: BoUser、BoAuthToken エンティティ追加（予定）
  - api-spec.md: BoAuth API、管理API（/api/bo/**）の仕様追加（予定）

### CHG-011: 商品一覧ページネーション
- **実装完了日**: 2026-02-18
- **内容**: 商品一覧画面にページネーションUI追加（1ページ12件、URL連動）
- **主要ドキュメント反映先**:
  - ui/customer-ui.md: 商品一覧画面にページネーション仕様追記
  - spec-implementation-gaps.md: L-1を実装完了に更新

### CHG-013: モジュラーモノリス設計
- **実装完了日**: 2026-02-18
- **内容**: パッケージ構造をモジュール別に再編、Port/UseCase パターン導入、ArchUnit 境界テスト追加、監査ログのイベント駆動化
- **主要ドキュメント反映先**:
  - SPEC.md: アーキテクチャ変更履歴にモジュール構造・制約を追加

### CHG-012: API契約管理
- **実装完了日**: 2026-02-18
- **内容**: springdoc-openapi導入、全コントローラ/DTOにOpenAPIアノテーション付与、Swagger UI公開
- **主要ドキュメント反映先**: ツーリング追加のみのためドキュメント影響なし

### CHG-015: OpenTelemetry 導入
- **実装完了日**: 2026-02-19
- **内容**: OTel Collector / Jaeger / Prometheus / Grafana 導入、全レイヤの分散トレーシング・ビジネスメトリクス計測基盤を構築
- **主要ドキュメント反映先**:
  - SPEC.md: アーキテクチャ変更履歴にOTel観測スタックと既存変更を追加
  - specs/bff-architecture.md: 共通機能セクションにOTel SDK統合・インターセプタ変更を反映

### CHG-014: Redis導入とBFF機能拡張
- **実装完了日**: 2026-02-18
- **内容**: Redis 7.2導入、BFFにキャッシュ層・セッション管理・レート制限・レスポンス集約エンドポイントを実装
- **主要ドキュメント反映先**:
  - SPEC.md: アーキテクチャ変更履歴にRedis導入・データ配置原則を追加
  - specs/bff-architecture.md: 設計原則・エンドポイント・モジュール構成・レート制限を更新
  - ui/api-spec.md: BFF集約エンドポイントセクション追加
  - specs/authentication.md: BFF認証トークンキャッシュ仕様を追加

## 参照方法

アーカイブされた案件を参照する場合:

```bash
# 特定案件の要件定義を確認
cat docs/archive/01_requirements/CHG-006_会員機能追加.md

# 特定案件の技術設計を確認
cat docs/archive/02_designs/CHG-006_Task1_会員登録とログイン基盤.md

# 特定案件のタスク一覧を確認
ls docs/archive/03_tasks/CHG-006*.md
```

## 注意事項

- **アーカイブされたドキュメントは編集しない**: 主要ドキュメントが正式な仕様
- **履歴参照目的**: なぜその仕様になったのか、どのように実装したのかを振り返る目的で参照
- **新規機能開発**: 主要ドキュメント（SPEC.md、requirements.md など）を基に進める

## 関連ドキュメント

- [CLAUDE.md](../../CLAUDE.md) - プロジェクトガイド、機能開発プロセス、アーカイブルール
- [SPEC.md](../SPEC.md) - 技術仕様書（Single Source of Truth）
- [requirements.md](../requirements.md) - 業務要件・ビジネスルール
- [data-model.md](../data-model.md) - データモデル・エンティティ定義
