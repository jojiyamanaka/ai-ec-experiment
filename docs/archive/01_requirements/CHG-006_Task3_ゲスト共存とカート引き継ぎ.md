# CHG-006 Task3: ゲスト共存とカート引き継ぎ

## 背景・課題

会員機能導入時の体験劣化ポイントは、ゲストで入れたカートがログイン後に失われること。
現行 `sessionId` ベースと会員ベースの共存ルールをここで固定する。

## ビジネス要件

### REQ-3-001: ゲスト継続
- 未ログイン時は既存どおり `sessionId` ベースでカート操作できる

### REQ-3-002: ログイン時カート引き継ぎ
- ログイン時にゲストカートを会員カートへ移行する
- 同一商品が重複した場合の数量合算ルールを定義する
- 上限超過時の解決ルールを定義する

### REQ-3-003: 在庫整合性
- 引き継ぎ時も在庫上限・公開状態・仮引当整合性を維持する

### REQ-3-004: エラー通知
- 引き継ぎ失敗時にユーザー向けメッセージで再操作手順を提示する

## 受け入れ条件

### AC-3-001: 引き継ぎ成功
- [ ] ゲストで商品追加後にログインすると会員カートへ移行される
- [ ] 商品/数量がルールどおり反映される

### AC-3-002: 例外系
- [ ] 上限超過・在庫不足時に仕様どおりの結果になる
- [ ] 引き継ぎ失敗時にカート不整合が残らない

### AC-3-003: 後方互換
- [ ] ログインしない利用者のカート機能が従来どおり動作する

## 対象外

- 会員注文履歴
- 管理者ロール制御
