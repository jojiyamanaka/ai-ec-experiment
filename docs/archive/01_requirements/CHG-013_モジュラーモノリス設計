# CHG-013: モジュラーモノリス設計メモ（ECアーキテクチャ向け）

作成日: 2026-02-18
---
## 1. 背景
- 中〜大規模ECで、早期のマイクロサービス化により運用負荷が増大しやすい。
- 横割り（controller/service/repository/entity）構造やEntityの共有参照により、依存関係が崩壊しやすい。
- 将来の分割可能性を残しつつ、現時点の開発速度と運用容易性を両立する設計が必要。

---
## 2. 要件
- デプロイは単一のモノリスとしつつ、内部を明確なモジュール境界で分割する（モジュラーモノリス）。
- ECの主要ドメインをモジュールとして分割する（例: catalog / inventory / order / payment / customer / backoffice / shared）。
- 管理画面（backoffice）は別ドメイン化せず、同一ドメインを別ユースケースとして利用する前提とする。
- モジュール間の連携方法を「必要最小限の同期」または「イベント（非同期）」に限定する。
- DBは単一を許容するが、モジュール責務でテーブルを分け、クロスモジュールJOIN前提の設計は避ける。
- 最重要境界として order / payment / inventory を優先的に明確化する。
- checkout は上記モジュールを調整するユースケースとして扱う。

---
## 3. 受け入れ条件
- 各モジュールの境界が明確で、他モジュールのEntity/Repositoryを直接参照しない前提になっている。
- モジュール間のデータ連携はID参照を基本とし、直接的なオブジェクト参照（例: JPAの跨ぎ関連）を前提にしない。
- 連携ルールが「同期（最小限）」と「イベント（非同期）」の2系統に整理されている。
- 依存方向の固定・循環禁止・境界逸脱防止を仕組みで担保する方針が明記されている。
- 将来のサービス分割を阻害しない（クロスモジュールJOIN依存・境界不明確な横割り構造を回避する）意図が明確である。

---
## 4. 仕様への反映
- アーキテクチャ方針として「モジュラーモノリス」を採用し、モジュール分割の責務範囲を仕様に明記する。
- モジュール間の依存・連携方式（同期/イベント）を仕様上の制約として定義する。
- データ設計方針（単一DB可、モジュール責務でテーブル分割、ID参照、クロスJOIN非前提）を仕様へ反映する。
- 優先境界（order/payment/inventory）と checkout の位置付け（調整ユースケース）を仕様上の概念として固定する。
- 典型アンチパターン（横割り構造、Entity共有参照）を禁止事項として仕様に明記する。

---
## 5. 関連資料
- 入力メモ「モジュラーモノリス設計メモ（ECアーキテクチャ向け）」