# API契約管理 要件定義
docs/01_requirements/api-contract-management.md

---

## 1. 目的（Why）

ECアーキテクチャにおいて、
CoreAPIの変更がBFFやフロントエンドへ与える影響を最小化し、
「壊さない進化」を実現する。

React → BFF → CoreAPI → DB の多層構成において、
API仕様を明文化し、破壊的変更を未然に防ぐ。

---

## 2. 背景

- API変更によるBFF障害のリスク
- enum変更や必須項目追加による画面障害
- 将来的なマイクロサービス化への備え
- 複数クライアント（フロント／管理画面）共存

---

## 3. スコープ（What）

対象：

- CoreAPIの外部公開API仕様
- BFFが依存するAPI契約
- フロント／管理画面に影響するレスポンス構造

対象外：

- 内部Entity構造
- 実装詳細
- DBスキーマ設計

---

## 4. ゴール

- API仕様を単一の契約として明文化する
- 破壊的変更を事前に検知できる状態にする
- 後方互換を原則とする運用を確立する
- 仕様と実装の乖離を防止する

---

## 5. 非機能要件

- API変更は明示的に管理されること
- 破壊的変更は原則禁止
- 変更の影響範囲を可視化できること
- 仕様は常に最新状態を維持すること

---

## 6. 破壊的変更の定義

以下は原則禁止とする：

- 必須フィールド追加
- フィールド削除
- 型変更
- enum削除
- パス削除
- nullable → 必須への変更

許容される変更：

- optionalフィールド追加
- enum値追加
- 新規エンドポイント追加

---

## 7. バージョニング方針

- 原則として後方互換を維持する
- 破壊的変更が必要な場合のみ新バージョンを追加
- 旧バージョンは一定期間維持する
- 廃止予定は明示する

---

## 8. 役割責務

CoreAPI：
- 契約の提供者
- 後方互換維持の責任を持つ

BFF：
- 契約の利用者
- Core内部実装に依存しない

---

## 9. 成功基準

- API変更による本番障害が発生しない
- 契約違反が事前に検知される
- フロント／BFFの改修が予測可能になる
- 将来のサービス分割に耐えうる設計になる

---

## 10. 結論

API契約管理は、
ECシステムを安全に進化させるための基盤である。

最小要件は：

- 契約の明文化
- 破壊的変更の抑止
- 後方互換の原則維持

以上を満たすことを本要件とする。