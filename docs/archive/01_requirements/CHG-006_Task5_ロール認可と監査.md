# CHG-006 Task5: ロール認可と監査

## 背景・課題

会員機能を導入しても、管理 API が無防備のままだと運用リスクが高い。
最終 Step としてロール認可と監査ログを追加し、最低限の運用安全性を確保する。

## ビジネス要件

### REQ-5-001: ロール定義
- `CUSTOMER` と `ADMIN` を定義する
- 会員にはロールを付与できる

### REQ-5-002: 管理 API の認可
- 商品更新、注文ステータス更新、全注文取得は `ADMIN` のみ許可する
- 非管理者アクセスは HTTP 403 を返す

### REQ-5-003: パスワード保護
- パスワードをハッシュ化して保存する
- 認証失敗理由を過度に開示しない

### REQ-5-004: 監査ログ
- ログイン成功/失敗、認可エラー、管理操作を監査ログとして記録する

## 受け入れ条件

### AC-5-001: 認可
- [ ] 非管理者が管理 API を実行すると HTTP 403 になる
- [ ] 管理者は既存の管理操作を継続利用できる

### AC-5-002: セキュリティ
- [ ] パスワード平文保存がない
- [ ] 認証失敗時にアカウント存在有無を判別できない

### AC-5-003: 監査
- [ ] 監査対象イベントがログとして確認できる

### AC-5-004: 全体整合
- [ ] Step1〜4 の機能を破壊していない

## 対象外

- 二要素認証
- 外部 ID プロバイダ連携
- 高度な不正検知
