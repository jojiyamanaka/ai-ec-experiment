# CHG-006: 会員機能追加（分割計画）

## 背景・課題

現行実装はゲスト購入を前提としており、顧客識別は `X-Session-Id` のみで行っている。

- フロントエンドは `localStorage` の `sessionId` を自動生成し、`/api/order/*` に送信
- カート・注文・在庫仮引当が `sessionId` に紐づく
- 管理系 API に認証・認可がない
- 会員登録、ログイン、注文履歴（会員単位）が未実装

このため、会員機能は1件の変更として扱うと影響範囲が広すぎる。段階的に導入する前提で分割する。

## 分割方針

- 実施順に 5 Step に分割する
- 各 Step 単体で受け入れ可能な状態を定義する
- 既存ゲスト購入フローは常に維持する（後方互換）
- 各 Step で `ApiResponse<T>` 形式を維持する

## 実施順マップ

| Step | 要件ファイル | 主目的 |
|------|-------------|--------|
| 1 | `docs/01_requirements/CHG-006_Task1_会員登録とログイン基盤.md` | 会員アカウント作成と認証 API の追加 |
| 2 | `docs/01_requirements/CHG-006_Task2_認証状態と画面導線.md` | フロントのログイン状態管理と導線追加 |
| 3 | `docs/01_requirements/CHG-006_Task3_ゲスト共存とカート引き継ぎ.md` | ゲストと会員の共存、ログイン時のカート統合 |
| 4 | `docs/01_requirements/CHG-006_Task4_会員注文履歴.md` | 会員単位の注文履歴・注文詳細 |
| 5 | `docs/01_requirements/CHG-006_Task5_ロール認可と監査.md` | 管理 API 保護、監査ログ、運用上の最低限セキュリティ |

## 完了定義（CHG-006 全体）

- Step 1 〜 Step 5 の受け入れ条件がすべて満たされる
- 未ログインユーザーの既存購入フローが維持される
- 管理系 API が非管理者から実行できない
- 会員ユーザーが自身の注文履歴を参照できる

## 対象外（CHG-006 全体）

- SNS ログイン（Google/Apple 等）
- メール認証、パスワード再発行、二要素認証
- ポイント、クーポン、会員ランク
- 外部 ID プロバイダ（Auth0/Cognito 等）連携
