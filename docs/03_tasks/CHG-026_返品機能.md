# CHG-026: è¿”å“æ©Ÿèƒ½ - å®Ÿè£…ã‚¿ã‚¹ã‚¯

è¦ä»¶: `docs/01_requirements/CHG-026_è¿”å“æ©Ÿèƒ½.md`
è¨­è¨ˆ: `docs/02_designs/CHG-026_è¿”å“æ©Ÿèƒ½.md`
ä½œæˆæ—¥: 2026-03-01

---

## ã‚¿ã‚¹ã‚¯ä¸€è¦§

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰

- [ ] **T-1** `[CONTRACT]`: è¿”å“ã‚¹ã‚­ãƒ¼ãƒè¿½åŠ ã¨å½±éŸ¿ãƒ†ãƒ¼ãƒ–ãƒ«ã®E2Eå‚ç…§ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°ã™ã‚‹

  è§¦ã‚‹ç¯„å›²: `backend/src/main/resources/db/flyway / backend/src/main/resources/db/e2e/{seed_reference_data.sql,assert_reference_data.sql} / purchase.order.entity.Order / purchase.shipment.entity.Shipment / product.domain.entity.Product / docs/data-model.md / docs/specs/order.md`

  Done: `bash ./scripts/e2e_seed.sh` ãŒæˆåŠŸã—ã€`cd backend && ./mvnw compile` ãŒé€šã‚‹ã“ã¨

  > ğŸ“ ã‚²ãƒ¼ãƒˆé«˜ã€‚Codex ã¯ review-noteï¼ˆå¤‰æ›´ã®æ¦‚è¦ãƒ»åˆ¤æ–­ã®æ ¹æ‹ ï¼‰ã‚’ `docs/04_review-note/CHG-026.md` ã® `## T-1` ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«è¿½è¨˜ã—ã€è¿½åŠ æ¤œè¨¼ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã€‚Final Gate çµæœã¨ Review Packet ã‚‚åŒãƒ•ã‚¡ã‚¤ãƒ«ã¸è¨˜éŒ²ã™ã‚‹ã“ã¨ã€‚

---

- [ ] **T-2** `[ARCH]`: è¿”å“ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã¨Core APIã‚’è¿½åŠ ã—ã€æ³¨æ–‡å–å¾—ç³»ã¸è¿”å“æƒ…å ±ã‚’çµ±åˆã™ã‚‹

  è§¦ã‚‹ç¯„å›²: `backend/modules/purchase/adapter/rest / backend/modules/purchase/application/{port,usecase} / purchase.shipment.repository.ShipmentRepository / purchase.application.usecase.OrderUseCase`

  Done: `cd backend && ./mvnw test -Dtest=ReturnUseCaseTest,ReturnControllerTest,OrderUseCaseTest,ModularMonolithArchitectureTest` ãŒé€šã‚‹ã“ã¨

  > ğŸ“ ã‚²ãƒ¼ãƒˆé«˜ã€‚Codex ã¯ review-noteï¼ˆå¤‰æ›´ã®æ¦‚è¦ãƒ»åˆ¤æ–­ã®æ ¹æ‹ ï¼‰ã‚’ `docs/04_review-note/CHG-026.md` ã® `## T-2` ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«è¿½è¨˜ã—ã€è¿½åŠ æ¤œè¨¼ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã€‚Final Gate çµæœã¨ Review Packet ã‚‚åŒãƒ•ã‚¡ã‚¤ãƒ«ã¸è¨˜éŒ²ã™ã‚‹ã“ã¨ã€‚

---

### BFF

- [ ] **T-3** `[CONTRACT]`: è¿”å“ç”¨BFFã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¨å…±æœ‰DTOã‚’è¿½åŠ ã—ã€OpenAPIã‚’åŒæœŸã™ã‚‹

  è§¦ã‚‹ç¯„å›²: `bff/shared/src/{dto/return.dto.ts,index.ts} / bff/customer-bff/src/{returns,app.module.ts} / bff/backoffice-bff/src/{returns,app.module.ts} / docs/api/customer-bff-openapi.json / docs/api/backoffice-bff-openapi.json`

  Done: `npm run build --prefix bff/shared && npm run build --prefix bff/customer-bff && npm run generate:openapi --prefix bff/customer-bff && npm run build --prefix bff/backoffice-bff && npm run generate:openapi --prefix bff/backoffice-bff` ãŒé€šã‚‹ã“ã¨

  > ğŸ“ ã‚²ãƒ¼ãƒˆé«˜ã€‚Codex ã¯ review-noteï¼ˆå¤‰æ›´ã®æ¦‚è¦ãƒ»åˆ¤æ–­ã®æ ¹æ‹ ï¼‰ã‚’ `docs/04_review-note/CHG-026.md` ã® `## T-3` ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«è¿½è¨˜ã—ã€è¿½åŠ æ¤œè¨¼ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã€‚Final Gate çµæœã¨ Review Packet ã‚‚åŒãƒ•ã‚¡ã‚¤ãƒ«ã¸è¨˜éŒ²ã™ã‚‹ã“ã¨ã€‚

---

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰

- [ ] **T-4** `[SAFE]`: è¿”å“ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã¨æ³¨æ–‡ç”»é¢ã®è¿”å“UIã‚’è¿½åŠ ã™ã‚‹

  è§¦ã‚‹ç¯„å›²: `frontend/src/entities/return / frontend/src/entities/order/model/types.ts / frontend/src/pages/customer/OrderHistoryPage/index.tsx / frontend/src/pages/admin/AdminOrderPage/index.tsx`

  Done: `npm run build --prefix frontend && npm run test:regression --prefix frontend` ãŒé€šã‚‹ã“ã¨

  UIç¢ºèª: MCP Playwright ã§é¡§å®¢ã®è³¼å…¥å±¥æ­´ã‹ã‚‰è¿”å“ç”³è«‹å°ç·šã¨è¿”å“ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤ºã€ç®¡ç†ç”»é¢ã®æ³¨æ–‡è©³ç´°ãƒ¢ãƒ¼ãƒ€ãƒ«ã§è¿”å“æƒ…å ±è¡¨ç¤ºã¨æ‰¿èª/æ‹’å¦/ç¢ºå®šå°ç·šã‚’ç¢ºèªã§ãã‚‹ã“ã¨

---

## å®Ÿè£…é †åº

```
T-1 â†’ T-2 â†’ T-3 â†’ T-4
```

---

## æ¤œè¨¼

### Per-task æ¤œè¨¼ã‚³ãƒãƒ³ãƒ‰

å„ã‚¿ã‚¹ã‚¯å®Œäº†æ™‚ã«å®Ÿè¡Œã™ã‚‹æœ€å°æ¤œè¨¼:

```bash
# T-1
bash ./scripts/e2e_seed.sh
cd backend && ./mvnw compile

# T-2
cd backend && ./mvnw test -Dtest=ReturnUseCaseTest,ReturnControllerTest,OrderUseCaseTest,ModularMonolithArchitectureTest

# T-3
npm run build --prefix bff/shared
npm run build --prefix bff/customer-bff
npm run generate:openapi --prefix bff/customer-bff
npm run build --prefix bff/backoffice-bff
npm run generate:openapi --prefix bff/backoffice-bff

# T-4
npm run build --prefix frontend
npm run test:regression --prefix frontend
```

### Final Gateï¼ˆå…¨ã‚¿ã‚¹ã‚¯å®Œäº†å¾Œã«å¿…ãšå®Ÿè¡Œã—ã€çµæœã‚’ `docs/04_review-note/CHG-026.md` ã«è¨˜éŒ²ã™ã‚‹ã“ã¨ï¼‰

```bash
cd backend && ./mvnw compile
cd backend && ./mvnw test
npm run build --prefix bff/shared
npm run build --prefix bff/customer-bff
npm run build --prefix bff/backoffice-bff
npm run build --prefix frontend
docker compose up -d
```

**Final Gate è¨˜éŒ²å…ˆ:** `docs/04_review-note/CHG-026.md` ã® `## Final Gate çµæœ`

---

## ãƒ†ã‚¹ãƒˆæ‰‹é †

1. é…é€å®Œäº†ã‹ã‚‰30æ—¥ä»¥å†…ã®æ³¨æ–‡ã§è¿”å“ç”³è«‹ã—ã€è¿”å“å¾…ã¡ã®Shipmentä½œæˆã¨ `returnShipment` ã‚µãƒãƒªè¡¨ç¤ºã‚’ç¢ºèªã™ã‚‹
2. `delivered_at` ãŒ NULL ã®æ—¢å­˜æ³¨æ–‡ã€31æ—¥è¶…éæ³¨æ–‡ã€è¿”å“ä¸å¯å•†å“ã€æ•°é‡è¶…éã€ä»–æ³¨æ–‡ã®æ˜ç´°æŒ‡å®šã§ãã‚Œãã‚ŒæœŸå¾…ã©ãŠã‚Šã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹
3. ç®¡ç†ç”»é¢ã‹ã‚‰æ‰¿èªãƒ»æ‹’å¦ãƒ»ç¢ºå®šã‚’é †ã«æ¤œè¨¼ã—ã€ä¸æ­£é·ç§»ï¼ˆæ‰¿èªæ¸ˆâ†’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã€çµ‚ç«¯çŠ¶æ…‹ã‹ã‚‰ã®æ›´æ–°ï¼‰ãŒæ‹’å¦ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹
4. MCP Playwright ã§é¡§å®¢ç”»é¢ã¨ç®¡ç†ç”»é¢ã®è¿”å“å°ç·šã€çŠ¶æ…‹è¡¨ç¤ºã€ãƒ¢ãƒ¼ãƒ€ãƒ«æ“ä½œã‚’ç¢ºèªã™ã‚‹
