# AI EC Experiment - 機能仕様書

## プロジェクト概要
AI がおすすめする商品を販売する EC サイトのプロトタイプ

**技術スタック**
- フロントエンド: React + TypeScript（Vite）
- スタイリング: Tailwind CSS
- ルーティング: React Router
- バックエンド: Spring Boot（予定）
- DB: SQLite（予定）

---

## 画面一覧

### 1. TOP画面（/）
**目的**: サイトのトップページ、おすすめ商品の表示

**主要要素**:
- ヘッダー（サイト名、カートアイコン）
- バナーエリア（キャッチコピー）
- おすすめ商品セクション（3件表示）
- フッター（管理画面へのリンク）

**機能**:
- おすすめ商品をカード形式で表示
- 商品カードクリックで商品詳細へ遷移
- 「すべて見る」で商品一覧へ遷移
- カートアイコンに数量バッジ表示

---

### 2. 商品一覧画面（/item）
**目的**: 全商品の一覧表示

**主要要素**:
- ヘッダー
- 商品一覧（グリッドレイアウト）
- フッター

**機能**:
- 公開されている商品のみを表示
- 各商品カードに以下を表示：
  - 商品画像
  - 商品名
  - 価格
  - 商品説明
  - 在庫状態バッジ（在庫あり/残りわずか/売り切れ）
- 商品カードクリックで商品詳細へ遷移

---

### 3. 商品詳細画面（/item/:id）
**目的**: 個別商品の詳細情報表示とカート追加

**主要要素**:
- ヘッダー
- 商品画像（大）
- 商品情報（名前、価格、在庫状態、説明）
- カート追加ボタン
- フッター

**機能**:
- 商品の詳細情報を表示
- 在庫状態に応じたバッジ表示
- 「カートに追加」ボタン
  - 在庫がある場合: カートに追加して /order/cart へ遷移
  - 売り切れの場合: ボタンを無効化
- カートアイコンに数量バッジ表示

---

### 4. カート画面（/order/cart）
**目的**: カート内容の確認と編集

**主要要素**:
- ヘッダー
- カート商品一覧
- 注文サマリー（小計、配送料、合計）
- アクションボタン
- フッター

**機能**:
- カート内の商品一覧を表示（商品画像、名前、説明、単価、数量、小計）
- 数量変更機能：
  - +/- ボタンで数量を増減
  - 数値入力欄で直接入力
  - 数量を 0 にすると自動削除
- 商品削除機能（ゴミ箱アイコン）
- 合計金額のリアルタイム計算
- 「レジに進む」ボタンで /order/reg へ遷移
- 「買い物を続ける」リンクで /item へ遷移
- カートが空の場合: 「カートは空です」メッセージと商品一覧へのリンク

---

### 5. 注文確認画面（/order/reg）
**目的**: 注文内容の最終確認

**主要要素**:
- ヘッダー
- 注文商品一覧（確認のみ、編集不可）
- お支払い金額（小計、配送料、手数料、合計）
- アクションボタン
- フッター

**機能**:
- カート内容を確認用に表示（数量変更不可）
- 合計金額の表示
- 「注文を確定する」ボタン
  - 注文番号を生成（ORD-YYYYMMDD-XXX形式）
  - カートをクリア
  - 注文情報を持って /order/complete へ遷移
- 「カートに戻る」リンクで /order/cart へ遷移
- カートが空の場合: エラーメッセージと商品一覧へのリンク

---

### 6. 注文完了画面（/order/complete）
**目的**: 注文完了の通知

**主要要素**:
- ヘッダー
- 完了メッセージ（チェックマークアイコン）
- 注文番号
- 注文内容サマリー
- お知らせ（メール送信、発送通知など）
- アクションボタン
- フッター

**機能**:
- 注文完了メッセージを表示
- 注文番号を強調表示
- 注文した商品の一覧と合計金額を表示
- 「TOPに戻る」ボタンで / へ遷移
- 「買い物を続ける」ボタンで /item へ遷移
- 直接URLアクセス時: エラーメッセージとTOPへのリンク

---

### 7. 管理画面（/bo/item）
**目的**: 商品情報の管理（価格、在庫、公開状態）

**主要要素**:
- ヘッダー
- 商品管理テーブル
- 保存ボタン
- フッター

**機能**:
- 全商品をテーブル形式で表示
- 各商品の編集機能：
  - 価格: 数値入力欄
  - 在庫数: 数値入力欄
  - 公開/非公開: トグルスイッチ
- 「保存」ボタンで変更を反映
  - 変更がない場合はボタンを無効化
  - 保存成功時にメッセージ表示
- 非公開にした商品は商品一覧（/item）に表示されない
- フッターの「管理画面」リンクからアクセス可能

---

## 主要機能

### 1. 商品閲覧機能
**機能概要**:
- 公開されている商品の閲覧
- 商品の詳細情報確認
- 在庫状態の可視化

**対象画面**:
- TOP画面
- 商品一覧画面
- 商品詳細画面

**仕様**:
- 非公開（isPublished = false）の商品は表示しない
- 在庫状態は在庫数に応じて自動判定
- 商品画像はプレースホルダーを使用

---

### 2. カート機能
**機能概要**:
- カートへの商品追加
- カート内商品の数量変更
- カート内商品の削除
- 合計金額の計算

**対象画面**:
- 商品詳細画面（追加）
- カート画面（編集）

**仕様**:
- カート状態は Context API で管理
- カートデータはメモリ上に保持（ページリロードで消失）
- 数量を 0 にすると自動的に削除
- 合計金額はリアルタイムで再計算

**カート内データ構造**:
```typescript
{
  items: CartItem[]        // カートアイテム配列
  totalQuantity: number    // 総数量
  totalPrice: number       // 合計金額
}
```

---

### 3. 注文機能
**機能概要**:
- カート内容の確認
- 注文の確定
- 注文番号の生成

**対象画面**:
- 注文確認画面
- 注文完了画面

**仕様**:
- 注文番号は `ORD-YYYYMMDD-XXX` 形式で自動生成
- 注文確定時にカートを自動クリア
- 注文情報は React Router の state で受け渡し
- 注文データはメモリ上に保持（永続化なし）

**注文フロー**:
1. カート画面で「レジに進む」
2. 注文確認画面で内容を確認
3. 「注文を確定する」で注文作成
4. カートがクリアされる
5. 注文完了画面に遷移

---

### 4. 商品管理機能（管理画面）
**機能概要**:
- 商品情報の一括編集
- 在庫数の管理
- 公開/非公開の切り替え

**対象画面**:
- 管理画面

**仕様**:
- 商品データは Context API で管理
- 変更は「保存」ボタンクリック時に反映
- 変更はメモリ上に保持（永続化なし）
- 非公開にした商品は即座に商品一覧から非表示

---

## 在庫状態のルール

商品の在庫数（stock）に応じて、在庫状態を3段階で表示します。

| 在庫数 | 状態 | 表示 | バッジ色 | 説明 |
|--------|------|------|----------|------|
| 6 以上 | 在庫あり | 「在庫あり」 | 緑（bg-green-500） | 十分な在庫がある状態 |
| 1〜5 | 残りわずか | 「残りわずか」 | オレンジ（bg-orange-500） | 在庫が少なくなっている状態 |
| 0 | 売り切れ | 「売り切れ」 | グレー（bg-gray-400） | 在庫がない状態 |

**在庫状態の影響**:
- **在庫あり・残りわずか**: カートに追加可能
- **売り切れ**: カートに追加不可（ボタンを無効化）

**判定ロジック**:
```typescript
function getStockStatus(stock: number) {
  if (stock === 0) {
    return { text: '売り切れ', color: 'bg-gray-400 text-white' }
  } else if (stock >= 1 && stock <= 5) {
    return { text: '残りわずか', color: 'bg-orange-500 text-white' }
  } else {
    return { text: '在庫あり', color: 'bg-green-500 text-white' }
  }
}
```

---

## 注文の状態遷移

注文は作成から完了まで、以下の状態を遷移します。

### 状態一覧

| 状態 | 英語表記 | 説明 |
|------|----------|------|
| 作成済み | PENDING | 注文が作成された初期状態 |
| 確認済み | CONFIRMED | 注文内容が確認され、処理が開始された状態 |
| 発送済み | SHIPPED | 商品が発送された状態 |
| 配達完了 | DELIVERED | 商品が配達完了した状態 |
| キャンセル | CANCELLED | 注文がキャンセルされた状態 |

### 状態遷移図

```
[PENDING]
   ↓ 確認
[CONFIRMED]
   ↓ 発送
[SHIPPED]
   ↓ 配達
[DELIVERED]

[PENDING] → [CANCELLED]（キャンセル可能）
[CONFIRMED] → [CANCELLED]（キャンセル可能）
```

### 遷移ルール

1. **PENDING → CONFIRMED**
   - 管理者が注文内容を確認
   - 在庫の引き当てを実施
   - 決済処理を実行

2. **CONFIRMED → SHIPPED**
   - 商品の梱包が完了
   - 配送業者に引き渡し
   - 追跡番号を発行

3. **SHIPPED → DELIVERED**
   - 配送業者が配達完了
   - 顧客が商品を受け取り

4. **PENDING/CONFIRMED → CANCELLED**
   - 顧客または管理者がキャンセル
   - 在庫を戻す
   - 決済をキャンセル

### 現在の実装状態

現在のフロントエンド実装では、注文作成時に `PENDING` 状態で作成されます。
バックエンド実装時に、状態遷移のロジックを追加する予定です。

---

## データモデル

### Product（商品）
```typescript
interface Product {
  id: number              // 商品ID
  name: string            // 商品名
  price: number           // 価格（円）
  image: string           // 商品画像URL
  description: string     // 商品説明
  stock: number           // 在庫数
  isPublished: boolean    // 公開状態
}
```

### CartItem（カートアイテム）
```typescript
interface CartItem {
  product: Product        // 商品情報
  quantity: number        // 数量
}
```

### Order（注文）
```typescript
interface Order {
  orderId: number         // 注文ID
  orderNumber: string     // 注文番号（ORD-YYYYMMDD-XXX形式）
  items: OrderItem[]      // 注文アイテム配列
  totalPrice: number      // 合計金額
  status: OrderStatus     // 注文状態
  createdAt: string       // 作成日時
  updatedAt: string       // 更新日時
}
```

### OrderItem（注文アイテム）
```typescript
interface OrderItem {
  product: Product        // 商品情報
  quantity: number        // 数量
  subtotal: number        // 小計
}
```

---

## 制約事項

### 現在の実装（Phase 1 - フロントエンドのみ）

1. **データの永続化なし**
   - 全データはメモリ上で管理
   - ページリロードで状態がリセット
   - ブラウザを閉じるとカート・注文情報が消失

2. **認証・認可なし**
   - ユーザー登録・ログイン機能なし
   - 管理画面へのアクセス制限なし
   - セッション管理なし

3. **決済機能なし**
   - 決済処理は未実装
   - 注文確定のみ

4. **在庫管理の簡易実装**
   - 注文時の在庫引き当てなし
   - 複数ユーザーの同時購入を考慮していない

### 今後の実装予定（Phase 2 以降）

1. **バックエンド API 実装（Spring Boot）**
   - REST API の実装
   - データベース連携（SQLite）
   - セッション管理

2. **データの永続化**
   - 商品データの DB 保存
   - 注文データの DB 保存
   - カートデータの永続化

3. **在庫管理の強化**
   - 注文時の在庫引き当て
   - トランザクション管理
   - 在庫切れ時の処理

4. **認証・認可**
   - ユーザー登録・ログイン
   - 管理画面のアクセス制限
   - JWT 認証

5. **決済機能**
   - 決済サービス連携
   - クレジットカード決済
   - 決済履歴管理

---

## 画面遷移図

```
[TOP画面 /]
  ↓ 商品カードクリック
[商品詳細 /item/:id]
  ↓ カートに追加
[カート /order/cart]
  ↓ レジに進む
[注文確認 /order/reg]
  ↓ 注文を確定する
[注文完了 /order/complete]

[TOP画面 /] → [商品一覧 /item] → [商品詳細 /item/:id]

[フッター] → [管理画面 /bo/item]
```

---

## 技術的な設計方針

### 状態管理
- **カート**: CartContext（React Context API）
- **商品**: ProductContext（React Context API）
- ページリロードで状態がリセットされる

### ルーティング
- React Router を使用
- クライアントサイドルーティング

### スタイリング
- Tailwind CSS を使用
- ユーティリティファーストアプローチ

### コンポーネント設計
- 関数コンポーネント
- カスタムフックの活用
- Props による型安全性

---

## 今後の拡張予定

1. **検索・フィルタリング機能**
   - 商品名での検索
   - 価格帯でのフィルタリング
   - カテゴリ分類

2. **レビュー・評価機能**
   - 商品レビューの投稿
   - 星評価
   - レビューの表示

3. **お気に入り機能**
   - 商品のお気に入り登録
   - お気に入り一覧

4. **注文履歴**
   - 過去の注文一覧
   - 注文詳細の確認
   - 再注文機能

5. **配送情報管理**
   - 配送先住所の登録
   - 配送状況の追跡

6. **AI レコメンデーション**
   - ユーザーの購買履歴に基づくおすすめ
   - 閲覧履歴に基づくおすすめ
   - 関連商品の表示
