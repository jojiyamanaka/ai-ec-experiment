---
name: task-planning
description: 技術設計書から実装タスクファイルを生成する。設計書の構造決定を作業単位に分割し、Done条件と検証コマンドを付けた薄いチェックリストを作成する。
argument-hint: "[CHG番号 例: CHG-011]"
---

# 実装タスクの作成

CHG番号: $ARGUMENTS

## 手順

### 1. 要件定義書・技術設計書の読み込み

`docs/01_requirements/` と `docs/02_designs/` から $ARGUMENTS に一致するファイルを検索して読み込む。
設計書が見つからない場合はユーザーに報告して終了する。

### 2. 設計書の構造決定を把握する

設計書に記載されている以下を理解する。実装詳細（メソッド内部・ビジネスロジック）の把握は不要。ただし、既存の命名規則・ディレクトリ構造に依存するパス（Flyway マイグレーション連番など）は Glob/Grep で確認してから記載すること。

- 影響するモジュール・クラス名
- レイヤ構成と依存方向
- トランザクション境界・非同期方式
- 新規作成 vs 既存変更の別

### 3. 実装タスクの作成

`docs/03_tasks/` にファイルを作成する。
ファイル名は設計書と同じ命名規則 (`CHG-XXX_<機能名>.md`) に従う。

構成テンプレートは [template.md](template.md) を参照。

#### タスク記述のルール

各タスクに含めること:

- **作業内容**: 「何をするか」を1行で（例: `OutboxEvent エンティティを新規作成`）
- **触る範囲**: モジュール名 / クラス名レベル（例: `shared/outbox/domain/entity / OutboxEvent`）
- **Done条件**: 観測可能な検証コマンド1行が原則（例: `./mvnw compile が通ること`、`./mvnw test -Dtest=XxxTest が通ること`）。「何を実装したか」の列挙は書かない（それは設計書の役割）。設計書に **冪等性・状態不変・副作用防止・境界制約** が明記されているタスクは、それを検証できるテストコマンドを Done条件に含めること（compile のみは不可）。その他コンパイル/テスト通過だけでは確認できない非自明な制約がある場合のみ補足を追記する。
- **タグ**: 以下のリスクタグを1つ以上付与する（詳細は後述）

各タスクに含めないこと（実装詳細 = Codex の担当）:

- 行番号・挿入位置の指定
- コピペ用のコード断片
- import 文の列挙や細かい命名規約
- Done条件への実装仕様の列挙（「〜が追加されている」「〜が存在すること」など触る範囲と重複する記述）

#### ゲート強度タグのルール

各タスクには必ず以下のいずれかのタグを付与する。AGENTS.md の「破壊的変更の扱い」と対応している。タグはゲート強度（実装後に必要な検証の厳しさ）を示す。

| タグ | ゲート強度 | 条件 |
|------|-----------|------|
| `[SAFE]` | 低 | 既存パターン内のロジック追加・テスト追加・バグ修正 |
| `[CONTRACT]` | 高 | エンドポイントの追加/削除/変更、HTTPステータス変更、レスポンス構造変更、DBスキーマ変更（カラム追加/削除/型変更）。エンドポイント・スキーマの**削除**を含む場合は、設計書の影響範囲欄から下流コンポーネント（BFF・フロントエンド）への影響を `⚠️` 補足としてタスクに追記すること |
| `[ARCH]` | 高 | モジュール境界・依存方向の変更、トランザクション境界の変更、非同期実行モデルの変更 |

実装は Codex の `/implementing CHG-XXX` スキルが担当する（`[CONTRACT]`/`[ARCH]` は `docs/impl-notes/CHG-XXX.md` への impl-notes 記録と追加検証が必要）。このスキル自体は実装を行わない。

#### タスク粒度のルール

- 1タスク = 1つの作業単位（1 PR を目安）
- タスクは T-1 → T-2 → T-3 と直列に実行する

### 4. ユーザーへの報告

作成したタスクの概要を報告する:
- タスク数と実装順序
- 検証コマンドと Done 条件の概要
