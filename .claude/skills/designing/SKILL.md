---
name: designing
description: 要件定義書から技術設計書を作成する。CHG番号指定で関連ドキュメントとコードを調査し設計書を生成する。
argument-hint: "[CHG番号 例: CHG-011]"
---

# 技術設計書の作成

CHG番号: $ARGUMENTS

## 手順

### 1. 要件定義書の読み込み

`docs/01_requirements/` から $ARGUMENTS に一致するファイルを検索して読み込む。
見つからない場合はユーザーに報告して終了する。

### 2. 関連ドキュメントの調査

要件定義書の内容を分析し、`docs/SPEC.md` のタスク別参照ガイドに従って関連ドキュメントを読み込む。
常に参照: `docs/SPEC.md`, `docs/requirements.md`

### 3. 既存コードパターンの調査

要件に関連する既存の実装を確認し、一貫性のある設計にする:

- バックエンド (`backend/src/`): エンティティ、サービス、コントローラ、DTO
- フロントエンド (`frontend/src/`): ページ、コンポーネント、Context、API呼び出し
- BFF (`bff/`): コントローラ、サービス、Core API連携

### 4. 設計判断が必要な場合はユーザーに質問する

以下のケースでは AskUserQuestion ツールで確認する:

- 複数の実装アプローチが考えられる場合
- 既存パターンから逸脱する必要がある場合
- 要件定義書に曖昧な点や不足情報がある場合
- 影響範囲が大きく方針確認が必要な場合
- API設計で複数の選択肢がある場合

質問は具体的な選択肢を提示し、トレードオフを説明すること。

### 5. 設計書の作成

`docs/02_designs/` にファイルを作成する。
ファイル名は要件定義書と同じ命名規則 (`CHG-XXX_<機能名>.md`) に従う。

構成テンプレートは [template.md](template.md) を参照。
過去の設計書の例は [examples/](examples/) を参照。

セクションは機能の規模に応じて取捨選択する。小規模な変更で不要なセクションは省略してよい。

**設計書に残すもの（構造の決定＝契約）**:
- API契約（エンドポイント・リクエスト/レスポンス構造・固定するもの）
- モジュール境界・レイヤ依存方向
- トランザクション境界・非同期方式・リトライ/冪等性方針
- 主要クラス/IFのシグネチャ（"契約"として。最小限）

**設計書から削るもの（実装詳細 = Codex の担当）**:
- 「このクラスのこのメソッドに追記」のような作業指示
- 行番号・挿入位置・差分手順
- コピペ用コード断片（IF定義の例示はOKだが最小限に）
- import 文の列挙や細かい命名規約

**混ざりやすい箇所の注意点**:

- **影響範囲**: 「何を触るか（クラス名・変更概要）」までにとどめる。「どう触るか（編集手順・差分）」は書かない
- **処理フロー**: 「箱と矢印」で登場コンポーネントと責務の流れを示す。if/for・例外の投げ方・メソッド呼び順の逐次記述は書かない

### 6. ユーザーへの報告

作成した設計書の概要を報告する:
- 設計方針の要約
- 主要な変更対象ファイル
- 設計上の判断事項や制約
