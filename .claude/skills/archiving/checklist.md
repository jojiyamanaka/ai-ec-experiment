# アーカイブ時のドキュメント更新チェックリスト

各ドキュメントについて「更新条件」に該当する場合のみ更新する。該当しない場合はスキップ。

## ドキュメント記述ルール

IMPORTANT: すべてのドキュメント更新時に以下を徹底する。これらのファイルは他のセッションで毎回読み込まれるため、冗長な記述はトークンの浪費に直結する。

### 書くもの
- コードを読むだけでは分からない設計判断・ビジネスルール
- 既存パターンと異なる例外的なルール
- エンティティ間の関係性や状態遷移など構造的な情報

### 書かないもの
- コードを読めば分かること（メソッド名、引数の型など）
- 標準的なフレームワーク規約の再説明
- 実装の詳細手順やチュートリアル的な記述
- 同じ情報の重複記載（1箇所に集約し、他からはリンク）

### 記述スタイル
- 箇条書き・表を優先。散文の説明は最小限にする
- 「何を・なぜ」を書く。「どうやって」はコードに任せる
- 長い説明が必要な場合は別ファイルに切り出してリンクする
- 削除の判断基準: 「これを消したらClaudeが間違いを犯すか？」→ No なら消す

## 必ず更新するドキュメント

### docs/archive/README.md
- **更新内容**: 「アーカイブ済み案件」セクションにエントリを追加
- **形式**: 既存エントリに倣う（CHG番号、実装完了日、内容、主要ドキュメント反映先）

## 条件付きで更新するドキュメント

### CLAUDE.md（プロジェクトルート）
- **更新条件**: フロントエンドのファイルパス・API呼び出し規約・型定義の配置が変わった場合
- **更新内容**: 「コーディング規約」セクションの該当行を実態に合わせて修正
- **スキップ例**: バックエンドのみの変更、UI改善のみ

### frontend/AGENTS.md
- **更新条件**: フロントエンドのディレクトリ構成・API呼び出し規約・型定義・状態管理の配置が変わった場合
- **更新内容**: 該当セクションを実態に合わせて修正
- **スキップ例**: バックエンドのみの変更

### backend/AGENTS.md
- **更新条件**: バックエンドのパッケージ構造・レイヤー構成・例外処理・DTO変換規約が変わった場合
- **更新内容**: 該当セクションを実態に合わせて修正
- **スキップ例**: フロントエンドのみの変更

### docs/SPEC.md
- **更新条件**: アーキテクチャに影響する変更（新レイヤー追加、通信方式変更、DB構成変更など）
- **更新内容**: 該当セクションを**マージ更新**する（追記ではなく現在状態の記述として更新）
  - 新サービス追加 → 「インフラ構成詳細」のサービス一覧を更新
  - モジュール構造・制約変更 → 「バックエンドアーキテクチャ」セクションを更新
  - 観測性の変更 → 「観測性」セクションを更新
  - 変更の経緯・背景はアーカイブドキュメントで管理（SPEC.md に変更履歴は残さない）
- **スキップ例**: UI改善、バリデーション追加、エラーメッセージ改善など

### docs/requirements.md
- **更新条件**: ビジネスルールの追加・変更がある場合
- **更新内容**: 該当するビジネスルールセクションに反映
- **スキップ例**: 技術的な改善のみの場合

### docs/data-model.md
- **更新条件**: エンティティの追加・変更、DB スキーマの変更がある場合
- **更新内容**: 該当エンティティの定義を更新
- **スキップ例**: フロントエンドのみの変更

### docs/api/openapi.json / docs/api/customer-bff-openapi.json / docs/api/backoffice-bff-openapi.json
- **更新条件**: APIエンドポイントの追加・変更がある場合
- **更新内容**: 該当する OpenAPI 契約を更新する
- **スキップ例**: バックエンド内部のロジック変更のみ

### docs/ui/customer-ui.md
- **更新条件**: 顧客画面の機能・UIに変更がある場合
- **更新内容**: 該当画面の仕様を更新
- **スキップ例**: 管理画面のみの変更、バックエンドのみの変更

### docs/ui/admin-ui.md
- **更新条件**: 管理画面の機能・UIに変更がある場合
- **更新内容**: 該当画面の仕様を更新
- **スキップ例**: 顧客画面のみの変更、バックエンドのみの変更

### docs/design-system.md
- **更新条件**: デザインシステム（カラー、タイポグラフィ、コンポーネント規約）に変更がある場合
- **更新内容**: 該当セクションを更新
- **スキップ例**: 既存デザインシステムに沿った実装

### docs/specs/ 配下
- **更新条件**: 該当ドメインの仕様に変更がある場合
- **対象ファイルの判定**:
  - 在庫関連 → `specs/inventory.md`
  - 注文関連 → `specs/order.md`
  - 認証関連 → `specs/authentication.md`（権限レベル・トークン検証フロー含む）
  - 商品関連 → `specs/product.md`
  - BFF関連 → `specs/bff-architecture.md`（認証キャッシュ、エンドポイント一覧含む）

### docs/agent-rules/monitoring.md
- **更新条件**: 観測性スタック（OTel, Jaeger, Prometheus, Grafana）の変更がある場合
- **更新内容**: 該当セクションのエンドポイント・メトリクス定義を更新
- **スキップ例**: 観測性に影響しない機能追加

## アーカイブ前の整合性チェック

IMPORTANT: このチェックリストは **verify PASS済みを前提**とする。設計契約・モジュール境界・要件充足の監査は `/verify` スキルが完了済みであり、ここで再監査しない。ドキュメント整地・ファイル移動・コミットのみを行う。

以下を必ず確認する:

### 参照パス存在チェック
- checklist.md 内で参照しているパスが実在すること（存在しない場合は先に checklist.md を修正する）

### API整合性
- API契約の正は `docs/api/openapi.json` / `docs/api/customer-bff-openapi.json` / `docs/api/backoffice-bff-openapi.json` とする
- 新規/変更エンドポイントが該当 OpenAPI ファイルに反映されているか
- `docs/specs/bff-architecture.md` は説明ドキュメントとして整合しているか（契約の厳密一致は OpenAPI を正とする）

### 認証整合性
- `docs/specs/authentication.md` のトークンフィールド定義が実際のエンティティと一致しているか（存在しないフィールド名を記載していないか）
- BoUser の権限レベルが実装コードと一致しているか

### フロントエンドパス整合性
- `docs/specs/*.md` の「実装クラス一覧」のフロントエンドパスが現在の FSD ディレクトリ構成と一致しているか
- FSD 構成変更時は `specs/product.md`, `specs/inventory.md`, `specs/order.md` の実装クラス一覧を更新する

### BFF キャッシュ整合性
- Redis キャッシュが追加・変更された場合、`specs/bff-architecture.md` の認証方式セクションと `specs/authentication.md` セクション10に反映されているか
